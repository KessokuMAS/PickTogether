<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>í€ë”© ì™„ë£Œ</title>
  <style>
    :root {
      --bg1: #f0fdf4;
      --bg2: #ffffff;
      --fg1: #111827;
      --fg2: #374151;
      --accent: #10b981;
      --muted: #6b7280;
      --shadow: 0 10px 20px rgba(0,0,0,.06);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", Arial, sans-serif;
      background: linear-gradient(180deg, var(--bg1), #fff);
      color: var(--fg1);
    }
    .wrap {
      min-height: 100svh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 24px;
    }
    .card {
      width: 100%;
      max-width: 520px;
      background: var(--bg2);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 24px;
      animation: pop .2s ease-out;
    }
    @keyframes pop { from { transform: scale(.98); opacity: .0 } to { transform: scale(1); opacity: 1 } }
    .ok {
      width:72px;height:72px;border-radius:50%;
      display:grid;place-items:center;
      margin: 4px auto 12px;
      background: rgba(16,185,129,.12);
      color: var(--accent);
      font-size: 40px;
    }
    h1{margin:8px 0 4px;font-size:22px;}
    p.subtitle{margin:0 0 18px;color:var(--muted)}
    .rows {border-top:1px solid #eef2f7;margin-top:8px}
    .row {
      display:flex;justify-content:space-between;gap:12px;
      padding: 12px 0;border-bottom:1px dashed #eef2f7;
    }
    .row:last-child{border-bottom:0}
    .key {color:#6b7280;font-weight:600}
    .val {color:#111827;font-weight:600; text-align:right; word-break: break-all;}
    .btns {
      display:flex; gap:10px; margin-top:18px; flex-wrap:wrap;
    }
    .btn {
      flex:1 1 auto;
      padding:12px 14px; border-radius:12px; text-align:center;
      text-decoration:none; font-weight:700;
      border:1px solid #e5e7eb; background:#f9fafb; color:#111827;
      transition:.15s ease;
    }
    .btn.primary{ background: var(--accent); color:#fff; border-color: var(--accent); }
    .btn:hover{ transform: translateY(-1px); box-shadow: var(--shadow); }
    .help { margin-top:10px; text-align:center; font-size:12px; color:#6b7280 }
    .badge {
      display:inline-block; padding:4px 8px; border-radius:999px;
      font-size:12px; font-weight:700; background:#ecfeff; color:#0ea5e9; border:1px solid #cffafe;
    }
    .err { color:#b91c1c; background:#fef2f2; border:1px solid #fee2e2; padding:10px 12px; border-radius:12px; font-size:14px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size: 13px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="card">
      <div class="ok" aria-hidden="true">âœ“</div>
      <h1>í€ë”©ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</h1>
      <p class="subtitle" id="subtitle">ê°€ê²Œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</p>

      <div class="rows" id="rows" hidden>
        <div class="row">
          <div class="key">í€ë”© ID</div>
          <div class="val mono" id="fundingId">-</div>
        </div>
        <div class="row">
          <div class="key">ê°€ê²Œëª…</div>
          <div class="val" id="restaurantName">-</div>
        </div>
        <div class="row">
          <div class="key">ê²°ì œ ë²ˆí˜¸</div>
          <div class="val mono" id="impUid">-</div>
        </div>
        <div class="row">
          <div class="key">ê²°ì œ ê¸ˆì•¡</div>
          <div class="val" id="totalAmount">-</div>
        </div>
        <div class="row">
          <div class="key">ê²°ì œ ì¼ì‹œ</div>
          <div class="val" id="createdAt">-</div>
        </div>
      </div>

      <div class="btns">
        <a class="btn primary" id="goHome" href="#">í™ˆìœ¼ë¡œ</a>
        <a class="btn" id="goMyFunding" href="#">ë‚´ í€ë”© ë‚´ì—­</a>
        <a class="btn" id="printBtn" href="#">ì˜ìˆ˜ì¦ ì¸ì‡„</a>
      </div>

      <div class="help">
        <span class="badge">QR ìˆ˜ì‹  í˜ì´ì§€</span>
        URL íŒŒë¼ë¯¸í„°ë§Œ ìˆìœ¼ë©´ ì„œë²„ ì—†ì´ ë™ì‘í•©ë‹ˆë‹¤.
      </div>
    </div>
  </div>

  <script>
    (function () {
      /**
       * ì§€ì›í•˜ëŠ” ì…ë ¥ í˜•íƒœ
       * 1) ê°œë³„ íŒŒë¼ë¯¸í„°
       *    ?fundingId=1025&restaurantName=ëŒ€ìš°ë¶€ëŒ€ì°Œê°œ&impUid=imp_...&totalAmount=6500&createdAt=2025-08-21T17:25:06.379891
       * 2) JSON í†µì§¸ë¡œ (URL ì¸ì½”ë”©)
       *    ?data=%7B%22fundingId%22%3A1025%2C...%7D
       */
      const params = new URLSearchParams(location.search);

      function parseFromParams() {
        // ìš°ì„  data(JSON) ìš°ì„ 
        const dataStr = params.get("data");
        if (dataStr) {
          try {
            const obj = JSON.parse(decodeURIComponent(dataStr));
            return obj;
          } catch (e) {
            console.warn("data íŒŒë¼ë¯¸í„° JSON íŒŒì‹± ì‹¤íŒ¨:", e);
          }
        }
        // ê°œë³„ íŒŒë¼ë¯¸í„°
        const obj = {
          fundingId: numOrStr(params.get("fundingId")),
          restaurantName: params.get("restaurantName"),
          impUid: params.get("impUid"),
          totalAmount: numOrStr(params.get("totalAmount")),
          createdAt: params.get("createdAt"),
        };
        // ê°’ í•˜ë‚˜ë„ ì—†ìœ¼ë©´ null
        const hasAny = Object.values(obj).some(v => v !== null && v !== "" && v !== undefined);
        return hasAny ? obj : null;
      }

      function numOrStr(v) {
        if (v === null || v === undefined || v === "") return null;
        const n = Number(v);
        return Number.isFinite(n) ? n : v;
      }

      function formatAmount(v) {
        const n = Number(v);
        if (Number.isFinite(n)) return n.toLocaleString("ko-KR") + " ì›";
        // "6500ì›" ê°™ì€ ë¬¸ìì—´ë„ ì²˜ë¦¬
        const digits = String(v || "").replace(/[^\d]/g, "");
        if (digits) return Number(digits).toLocaleString("ko-KR") + " ì›";
        return "-";
      }

      function formatKST(isoLike) {
        if (!isoLike) return "-";
        // iOS í˜¸í™˜ì„ ìœ„í•´ Të¥¼ ê³µë°±ìœ¼ë¡œ ì¹˜í™˜í•˜ì—¬ íŒŒì‹± ë³´ì •
        const cleaned = isoLike.replace(" ", "T");
        const d = new Date(cleaned);
        if (isNaN(d.getTime())) return String(isoLike);
        return new Intl.DateTimeFormat("ko-KR", {
          year: "numeric", month: "2-digit", day: "2-digit",
          hour: "2-digit", minute: "2-digit", second: "2-digit",
          hour12: false
        }).format(d);
      }

      // ê¸°ë³¸ê°’(ë„¤ê°€ ì˜ˆì‹œë¡œ ì¤€ ê°’)
      const FALLBACK = {
        fundingId: 1025,
        restaurantName: "ëŒ€ìš°ë¶€ëŒ€ì°Œê°œ",
        impUid: "imp_478648649884",
        totalAmount: 6500,
        createdAt: "2025-08-21T17:25:06.379891",
      };

      const data = parseFromParams() || FALLBACK;

      // ë Œë”ë§
      const subtitle = document.getElementById("subtitle");
      const rows = document.getElementById("rows");
      const setText = (id, text) => document.getElementById(id).textContent = text;

      if (!data) {
        subtitle.outerHTML = '<div class="err">ìœ íš¨í•œ íŒŒë¼ë¯¸í„°ê°€ ì—†ìŠµë‹ˆë‹¤. QR ìƒì„± ì‹œ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì„ í¬í•¨í•´ì£¼ì„¸ìš”.</div>';
      } else {
        subtitle.textContent = `${data.restaurantName || "-"} ì—ì„œ ë§›ìˆëŠ” í•œ ë¼ë¥¼ ì¦ê²¨ë³´ì„¸ìš” ğŸ‰`;
        rows.hidden = false;
        setText("fundingId", data.fundingId ?? "-");
        setText("restaurantName", data.restaurantName ?? "-");
        setText("impUid", data.impUid ?? "-");
        setText("totalAmount", formatAmount(data.totalAmount));
        setText("createdAt", formatKST(data.createdAt));
      }

      // ë²„íŠ¼ ì•¡ì…˜ (í•„ìš” ì‹œ ë„¤ URLë¡œ êµì²´)
      const $home = document.getElementById("goHome");
      const $my = document.getElementById("goMyFunding");
      const $print = document.getElementById("printBtn");

      $home.addEventListener("click", (e) => {
        e.preventDefault();
        // í”„ë¡œì íŠ¸ í™ˆ URL ìˆìœ¼ë©´ ì—¬ê¸°ì— ë„£ì–´
        // location.href = "https://example.com/";
        history.length > 1 ? history.back() : alert("í™ˆ URLì„ ì„¤ì •í•˜ì„¸ìš”.");
      });

      $my.addEventListener("click", (e) => {
        e.preventDefault();
        // ë‚´ í€ë”© ë‚´ì—­ URL ìˆìœ¼ë©´ êµì²´
        // location.href = "https://example.com/myfunding";
        alert("ë‚´ í€ë”© ë‚´ì—­ URLì„ ì„¤ì •í•˜ì„¸ìš”.");
      });

      $print.addEventListener("click", (e) => {
        e.preventDefault();
        window.print();
      });
    })();
  </script>
</body>
</html>
